var h=Object.defineProperty;var d=(r,e,t)=>e in r?h(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e,t)=>(d(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const m=200;function l(r,e=m){let t=!1;if(typeof r!="function")throw new TypeError('"func" must be a function');let s=null;return(...i)=>{s&&clearTimeout(s),s=setTimeout(()=>{r(...i)},e),!t&&(clearTimeout(s),r(...i),t=!0,setTimeout(()=>{t=!1},e))}}const u={get(r,e,t){const s=Reflect.get(r,e,t);return console.log(s?`Cache: get from ${e.toString()}`:`Cache: no cached value for ${e.toString()}`),s},set(r,e,t,s){return console.log(`Cache: set for ${e.toString()}`),Reflect.set(r,e,t,s)}},p=()=>{let r=new Proxy({},u);return{print(){console.log(r)},reset(){r=new Proxy({},u)},get(e){return r[e]??null},save(e,t){r[e]=t}}};function v(r=document){const e=r.createElement("div");e.style.overflowY="scroll",e.style.visibility="hidden",e.style.width="50px",e.style.height="50px",r.body.append(e);const t=e.offsetWidth-e.clientWidth;return e.remove(),t}const f={multilineSearch:!1},c={...f,multilineSearch:!1},g=`Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris fringilla finibus elit, at fermentum magna tincidunt at. Vivamus blandit aliquam feugiat. In et dignissim sem, nec sagittis neque. Aenean euismod sem id ex bibendum lobortis. Aenean vel mattis mauris. In viverra purus in sagittis tempus. Suspendisse sagittis blandit enim ac pharetra. Vestibulum et bibendum nulla, vel commodo sem. Vivamus purus odio, posuere vitae bibendum id, convallis quis diam. Nullam nec eros vitae ligula convallis gravida quis at neque. Duis sagittis ullamcorper est, ac varius leo.

Nam aliquam suscipit porta. Nulla sed justo a tellus lacinia gravida non sit amet ligula. Nullam ullamcorper nisl ac lobortis placerat. Aliquam ac vehicula elit. Cras et vehicula lacus, vitae congue nulla. Donec sollicitudin et lectus id sodales. Donec commodo nibh ipsum, et volutpat massa feugiat id. Nam tempus nunc vitae massa facilisis pellentesque. Phasellus ac tincidunt dui. Mauris scelerisque metus vel enim semper pretium nec pretium diam. Integer vel imperdiet tortor, a maximus nisl. Aliquam nec dictum dolor. Phasellus vulputate elit a nisi mollis, sed tristique massa molestie.

Pellentesque ipsum urna, suscipit nec porta vel, tincidunt dictum orci. Aenean ornare ligula semper turpis facilisis, semper pulvinar velit pulvinar. Vestibulum id dolor ut tortor dictum porttitor. Vivamus id mauris ut nunc laoreet feugiat. Nunc vel rutrum nibh, vel gravida elit. Donec dignissim dolor vitae viverra commodo. Sed et eros a metus hendrerit ornare et at nisi. Vivamus porta, nisl eget rhoncus bibendum, justo massa posuere arcu, id cursus augue ipsum nec nulla. Suspendisse pulvinar ex ac est rutrum, non blandit justo feugiat.

Aenean orci enim, imperdiet eu porttitor ut, lacinia a purus. Vestibulum elementum vel arcu id tempor. Sed quis dignissim massa, eu dignissim erat. Maecenas malesuada est lobortis nulla feugiat, ullamcorper volutpat elit viverra. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Quisque aliquam feugiat ornare. Praesent ultrices finibus mollis. Nulla non lectus ac sapien euismod fermentum. Etiam vestibulum laoreet quam nec sagittis.

Donec nec elit sit amet leo lacinia tristique vitae fermentum tellus. Nullam vel vulputate diam. Pellentesque elementum vel purus eu ultricies. Vestibulum volutpat bibendum dapibus. Duis finibus lobortis metus, ac aliquet magna vulputate finibus. Fusce quam nulla, euismod vitae tempus ut, dignissim vitae risus. Vivamus fringilla mauris non ligula lobortis efficitur. Nunc finibus dui et mattis sollicitudin. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Aenean non rhoncus eros.`,b="ipsum",S=g,E=b,y={foundEntity:".backdrop mark",search:"#search-field",editor:".editor",container:".container",textContainer:".textContainer",multilineSwitcher:"#search-multiline"},T=(r,e)=>r.replaceAll(e,"<mark>$&</mark>");class w{constructor(e,t,s,i){a(this,"editor");a(this,"backdrop");a(this,"container");a(this,"search");a(this,"multilineSwitcher");a(this,"initialText");a(this,"initialSearch");a(this,"selectors");a(this,"options");a(this,"cache");this.initialText=e,this.initialSearch=t,this.selectors=s,this.options=i,this.cache=p(),this.multilineSwitcher=this.initMultilineSwitcher(),this.editor=this.initEditor(),this.search=this.initSearch(),this.container=this.createContainer(),this.backdrop=this.createBackdrop()}initEditor(){const e=document.querySelector(this.selectors.editor);if(!e)throw new TypeError('"editor" must be specified');return e}initSearch(){const e=document.querySelector(this.selectors.search);if(!e)throw new TypeError('"searchField" must be specified');return e}initMultilineSwitcher(){const e=document.querySelector(this.selectors.multilineSwitcher);if(!e)throw new TypeError('"checkboxSearchMultiline" must be specified');return e}createContainer(){const e=document.createElement("div");return e.className="container",e}createBackdrop(){const e=document.createElement("div");return e.className="backdrop",e.style.paddingRight=`${v()}px`,e}getHighlightedText(e,t){const s=this.cache.get(t);if(s)return s;if(!t)return this.cache.save("",e),e;const i=T(e,t);return this.cache.save(t,i),i}handleTextOrSearchUpdate(){this.backdrop.innerHTML=this.getHighlightedText(this.editor.value,this.search.value)}getClosestNode(e,t){for(const s of t)if(e<s.offsetTop)return s;return null}navigateToTheNextEntity(){const e=this.backdrop.querySelectorAll("mark"),t=this.editor.scrollTop,s=this.getClosestNode(t,e);s&&this.editor.scrollTo(0,s.offsetTop)}addEventListeners(){const e=l(()=>this.handleTextOrSearchUpdate()),t=i=>{i.key==="Enter"&&(i.preventDefault(),this.navigateToTheNextEntity())};this.search.addEventListener("keypress",t),this.search.addEventListener("input",e);const s=l(()=>{this.cache.reset(),this.handleTextOrSearchUpdate()});this.editor.addEventListener("input",s),this.editor.addEventListener("scroll",i=>{const n=i.target;this.backdrop.scrollTo(n.scrollLeft,n.scrollTop)}),this.multilineSwitcher.addEventListener("change",i=>{const n=i.target.checked;c.multilineSearch=n,this.search.removeEventListener("input",e),this.search.removeEventListener("keypress",t),n?this.switchToMultilineSearch():this.switchToBasicSearch(),this.search.addEventListener("input",e),this.search.addEventListener("keypress",t)})}addResizeObserver(){const e=this.editor,t=l(()=>{this.backdrop.scrollTo(e.scrollLeft,e.scrollTop)});new ResizeObserver(t).observe(e)}combineNodes(){var t;const e=this.container;e.append(this.backdrop,this.editor),(t=document.querySelector(this.selectors.textContainer))==null||t.append(e)}setDefaultValues(){if(this.editor.value=this.initialText,this.search.value=this.initialSearch,this.options.multilineSearch){const e=this.multilineSwitcher;e.checked=c.multilineSearch,e.dispatchEvent(new Event("change"))}}replaceSearchControl(e){var s;const t=this.search;(s=t.parentElement)==null||s.append(e),t==null||t.remove(),this.search=e}switchToMultilineSearch(){const e=this.search,t=document.createElement("textarea");t.id="search-field",t.value=e==null?void 0:e.value,this.replaceSearchControl(t)}switchToBasicSearch(){const e=this.search,t=document.createElement("input");t.type="text",t.id="search-field",t.value=e.value,this.replaceSearchControl(t)}init(){return this.addEventListeners(),this.addResizeObserver(),this.setDefaultValues(),this.combineNodes(),this.search.dispatchEvent(new Event("input")),this}}const q=(r,e)=>new w(r,e,y,c).init();window.addEventListener("load",()=>{q(S,E)});
